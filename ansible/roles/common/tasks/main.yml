---
- name: ensure required packages are installed
  become_user: root
  become: true
  apt: name={{item}} state=present
  with_items:
  - git
  - python3.4-dev
- file: path=/1 state=directory owner={{user}} group=archiveit
  become: true

# get recent virtualenv, which bundles a recent pip
- command: mktemp -d
  register: mktempd_out
- name: download virtualenv-15.1.0
  get_url:
    url: https://pypi.python.org/packages/d4/0c/9840c08189e030873387a73b90ada981885010dd9aea134d6de30cd24cb8/virtualenv-15.1.0.tar.gz
    dest: '{{mktempd_out.stdout}}'
    checksum: sha1:995ce0fa007210ac2f10258999d06813ecdd6eeb
- name: extract virtualenv-15.1.0.tar.gz
  unarchive: src={{mktempd_out.stdout}}/virtualenv-15.1.0.tar.gz dest={{mktempd_out.stdout}} copy=no
- name: run "python3 setup.py install" in {{mktempd_out.stdout}}/virtualenv-15.1.0
  become: true
  command: python3 setup.py install
           chdir={{mktempd_out.stdout}}/virtualenv-15.1.0
           creates=/usr/local/lib/python3.4/dist-packages/virtualenv-15.1.0-py3.4.egg/virtualenv.py
- file:
    path: '{{mktempd_out.stdout}}'
    state: absent
  become: true

# if ferm is installed:
- name: Include ferm firewall rules if we are on Ubuntu xenial
  when: ansible_os_family == "Ubuntu" and ansible_distribution_major_version == "16"
  include: ferm_firewall.yml
